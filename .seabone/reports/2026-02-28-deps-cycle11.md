# Deps Scan Report — Cycle 11 (2026-02-28)

## Summary

**7 new findings** (0 critical, 0 high, 4 medium, 3 low)
**18 total open deps findings** across all cycles (0 critical, 2 high, 9 medium, 7 low)
**Codebase Health Score: 55/100**
**Trend: degrading** — no fixes have been applied since the first scan (cycle 1); pyproject.toml has not been modified since project initialization.

---

## Scan Coverage

Files examined: `pyproject.toml`, `poetry.lock`, `pytest.ini`, all `app/**/*.py` files, `tests/conftest.py`.

Focus areas:
- Unused and legacy imports in Python files
- Dependencies imported but undeclared in pyproject.toml
- Missing type stubs for typed packages
- Deprecated API usage
- Outdated package versions with known CVEs (cross-referenced against cycle 1 and cycle 4 findings)
- Warning suppression masking unresolved dependency issues

---

## New Findings (Cycle 11)

| ID | Severity | File | Issue |
|----|----------|------|-------|
| deps-c11-1 | medium | ecm_storage.py:5 | `botocore` used as direct import but undeclared |
| deps-c11-2 | medium | pyproject.toml | `python-multipart` undeclared runtime dependency |
| deps-c11-3 | medium | pytest.ini:10 | 3 DeprecationWarnings suppressed instead of fixed |
| deps-c11-4 | medium | pyproject.toml:9 | Python `<3.13` constraint blocks runtime upgrades |
| deps-c11-5 | low | notification.py:5 | `from typing import List` legacy import (Python 3.11+) |
| deps-c11-6 | low | pyproject.toml:34 | Missing `boto3-stubs[s3]` type stubs in dev deps |
| deps-c11-7 | low | email.py:8 | `sqlalchemy.Session` imported for unused `db` parameter |

---

## Comparison with Previous Findings

### Cycle 4 → Cycle 11 (Still Open, No Fixes)

All 11 findings from cycles 1 and 4 remain **unresolved**. `pyproject.toml` has not been touched since project initialization (`git log -- pyproject.toml` confirms zero commits). The fix workflow for deps tasks has a structural gap: fix agents update `CHANGELOG.md` but never modify `pyproject.toml` or regenerate `poetry.lock`.

Regressions still open:
- **deps-c4-1** (HIGH): python-jose 3.3.0 — CVE-2024-33664, CVE-2024-33663 (JWT algorithm confusion)
- **deps-c4-2** (HIGH): jinja2 3.1.4 — CVE-2024-56201, CVE-2024-56326 (sandbox escape)
- **deps-c4-3** (MEDIUM): httpx 0.27.0 — outdated in webhook SSRF delivery path
- **deps-c4-4** (MEDIUM): cryptography 42.0.8 — multiple patches in 43.x–46.x
- **deps-c4-5** (MEDIUM): opentelemetry-instrumentation-* 0.47b0 — beta in production
- **deps-c4-6** (MEDIUM): `Session.bind` deprecated in search.py:69
- **deps-c4-7** (MEDIUM): fastapi 0.111.0 — 18+ months behind current
- **deps-c4-8** (LOW): pydantic 2.7.4 — validation fixes in 2.10+
- **deps-c4-9** (LOW): python-dotenv 1.0.1 — outdated
- **deps-c4-10** (LOW): `app/api/` missing `__init__.py`
- **deps-c4-11** (LOW): `app/schemas/` missing `__init__.py`

### New Patterns Identified in Cycle 11

1. **Undeclared transitive deps used directly**: both `botocore` and `python-multipart` are consumed directly by app code but only appear as transitive deps in poetry.lock. This pattern likely extends to other deps.

2. **pytest.ini warning suppression masking debt**: Three `filterwarnings = ignore:...` entries suppress real dependency problems rather than surfacing them. This is a process anti-pattern.

3. **Passlib/crypt workaround entrenched**: The `python = "<3.13"` constraint in pyproject.toml was added to prevent passlib failure on Python 3.13 (where `crypt` was removed). This silently ties the project's Python runtime to an ever-shrinking support window.

---

## Top 3 Priority Fixes

### 1. Fix deps fix workflow (structural — blocks all other fixes)
**Impact**: All 18 open deps findings remain unresolved because fix agents write changelog entries but never modify `pyproject.toml`.
**Action**: Update the fix agent prompt template to require: (a) modifying `pyproject.toml`, (b) running `poetry update <pkg>`, and (c) committing the updated `poetry.lock`.

### 2. Replace python-jose (deps-c4-1 / CVE)
**Impact**: CVE-2024-33664 and CVE-2024-33663 allow JWT algorithm confusion attacks — authentication bypass.
**Action**: Replace `python-jose` with `joserfc` in pyproject.toml; update `from jose import ...` in `app/services/auth_flow.py` and `app/observability.py`.

### 3. Replace passlib and remove Python <3.13 constraint (deps-c11-4)
**Impact**: Blocks Python 3.13 adoption. passlib 1.7.4 is unmaintained since 2020, uses removed `crypt` module, and generates DeprecationWarnings that are being silenced.
**Action**: Migrate to `argon2-cffi` (argon2id) or `pwdlib[argon2]`; update `app/services/auth_flow.py:33-36`; relax pyproject.toml Python constraint.

---

## Codebase Health Score: 55/100

| Category | Score Impact |
|----------|-------------|
| 2 open HIGH findings (CVEs) | -16 |
| 9 open MEDIUM findings | -18 |
| 7 open LOW findings | -7 |
| Structural fix workflow gap | -4 |
| **Base** | **100** |
| **Total** | **55** |

**Trend: degrading** vs cycle 4 (61/100) — 7 new findings, 0 fixes applied.

---

## Cumulative Open Findings (All Cycles)

| Severity | Count |
|----------|-------|
| Critical | 0 |
| High | 2 |
| Medium | 9 |
| Low | 7 |
| **Total** | **18** |
